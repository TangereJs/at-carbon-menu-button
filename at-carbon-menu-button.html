<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../at-carbon-icon-button/at-carbon-icon-button.html">
<link rel="import" href="../at-carbon-menu/at-carbon-menu.html">
<link rel="import" href="../at-core-dropdown/at-core-dropdown.html">

<dom-module id="at-carbon-menu-button">
  <template>
    <style>
      :host .relative-container {
        position: relative;
        display: block;
        height: 44px;
      }

      :host .absolute-container {
        position: absolute;
      }
    </style>
    <div class="relative-container">
      <div class="absolute-container">
        <at-carbon-icon-button id="trigger" class="{{trigger}}" icon="now:menu"></at-carbon-icon-button>
        <at-core-dropdown id="dropdown" position="{{position}}">
          <at-carbon-menu id="menu" items="{{items}}" value={{value}}>
            <content></content>
          </at-carbon-menu>
        </at-core-dropdown>
      </div>
    </div>
  </template>
  <script>
    'use strict';
    Polymer({
      is: 'at-carbon-menu-button',
      properties: {
        position: {
          type: String,
          value: "bottomLeft",
          xtype: "enum",
          xvaluelist: [{
            title: "Top Left",
            value: "topLeft"
          }, {
            title: "Top Right",
            value: "topRight"
          }, {
            title: "Bottom Left",
            value: "bottomLeft"
          }, {
            title: "Bottom Right",
            value: "bottomRight"
          }]
        },
        items: {
          type: Array,
          value: function() {
            return [];
          },
        },
        value: {
          type: String,
          value: "",
          notify: true
        }
      },
      ready: function() {
        var trigger = this.$.trigger;
        var dropdown = this.$.dropdown;
        var menu = this.$.menu;

        trigger.addEventListener('tap', function(event) {
          dropdown.toggle(trigger, event);
          // var tabEvent = document.createEvent("KeyboardEvent");
          // var initMethod = typeof tabEvent.initKeyboardEvent !== 'undefined' ? "initKeyboardEvent" : "initKeyEvent";
          // tabEvent[initMethod](
          //  "keydown", // event type : keydown, keyup, keypress
          //   true, // bubbles
          //   true, // cancelable
          //   window, // viewArg: should be window
          //   false, // ctrlKeyArg
          //   false, // altKeyArg
          //   false, // shiftKeyArg
          //   false, // metaKeyArg
          //   9, // keyCodeArg : unsigned long the virtual key code, else 0
          //   0 // charCodeArgs : unsigned long the Unicode character associated with the depressed key, else 0
          // );
          // menu.dispatchEvent(tabEvent);

          var focusEvent = document.createEvent('HTMLEvents');
          focusEvent.initEvent('focus', true, true);
          menu.dispatchEvent(focusEvent);

        });
      }
    });
  </script>
</dom-module>
